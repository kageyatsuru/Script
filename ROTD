local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
   Name = "ULTIMATE V12.7: AMETHYST MASTER",
   LoadingTitle = "V12.7 Mobile Reborn",
   LoadingSubtitle = "by Ori",
   Theme = "Amethyst", -- This changes the colors to purple/dark
   ConfigurationSaving = {
      Enabled = true,
      FolderName = "V12_Configs",
      FileName = "AmethystMaster"
   },
   KeySystem = false 
})

-- [[ SHARED CONFIG ]]
_G.SilentAimEnabled = false
_G.AimbotEnabled = false
_G.AutoBuyAmmo = false
local wallCheckEnabled = false
local targetBone = "Head"
local weapon = "ak47"
local smoothing = 0.5
local globalRange = 600
local fovRadius = 150
local FIRE_RATE = 0.1
local cd = 0
local lastBuy = 0

-- [[ TABS ]]
local CombatTab = Window:CreateTab("Combat", 4483362458) 
local UtilityTab = Window:CreateTab("Utility", 4483345998)

-- [[ COMBAT SECTION ]]
CombatTab:CreateSection("Targeting")

CombatTab:CreateToggle({
   Name = "Silent Aim",
   CurrentValue = false,
   Callback = function(Value) _G.SilentAimEnabled = Value end,
})

CombatTab:CreateToggle({
   Name = "Aimbot (CamLock)",
   CurrentValue = false,
   Callback = function(Value) _G.AimbotEnabled = Value end,
})

CombatTab:CreateSlider({
   Name = "Smoothing",
   Range = {1, 10},
   Increment = 1,
   Suffix = "Smooth",
   CurrentValue = 5,
   Callback = function(Value) smoothing = Value / 10 end,
})

CombatTab:CreateSlider({
   Name = "FOV Radius",
   Range = {30, 800},
   Increment = 10,
   Suffix = "px",
   CurrentValue = 150,
   Callback = function(Value) fovRadius = Value end,
})

CombatTab:CreateDropdown({
   Name = "Target Bone",
   Options = {"Head", "HumanoidRootPart"},
   CurrentOption = {"Head"},
   MultipleOptions = false,
   Callback = function(Option) targetBone = Option[1] end,
})

-- [[ UTILITY SECTION ]]
UtilityTab:CreateSection("Automation")

UtilityTab:CreateToggle({
   Name = "Auto Buy Ammo",
   CurrentValue = false,
   Callback = function(Value) _G.AutoBuyAmmo = Value end,
})

UtilityTab:CreateInput({
   Name = "Weapon Name",
   PlaceholderText = "e.g. ak47",
   RemoveTextAfterFocusLost = false,
   Callback = function(Text) weapon = Text end,
})

UtilityTab:CreateToggle({
   Name = "Wallcheck",
   CurrentValue = false,
   Callback = function(Value) wallCheckEnabled = Value end,
})

-- [[ ENGINE LOOP ]]
local player = game.Players.LocalPlayer
local camera = workspace.CurrentCamera
local replicatedStorage = game:GetService("ReplicatedStorage")

game:GetService("RunService").RenderStepped:Connect(function(delta)
    local char = player.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then return end
    
    -- Auto Buy Logic (Async for no lag)
    if _G.AutoBuyAmmo and tick() - lastBuy > 3 then
        lastBuy = tick()
        task.spawn(function()
            local ammoID = "#322" -- Default AK; can be expanded if needed
            pcall(function()
                replicatedStorage.Library.RemotesManager.ShopService:InvokeServer(
                    "buyammo",
                    { StoreObj = workspace.Interactables.Shop_Sundays },
                    ammoID
                )
            end)
        end)
    end

    if not (_G.SilentAimEnabled or _G.AimbotEnabled) then return end
    cd = math.max(0, cd - delta)
    local gun = char:FindFirstChild(weapon)
    
    local center = Vector2.new(camera.ViewportSize.X / 2, camera.ViewportSize.Y / 2)
    local closest, minScore, targetHum = nil, math.huge, nil
    local entities = workspace:FindFirstChild("Entity")
    
    if entities then
        for _, v in pairs(entities:GetChildren()) do
            local t = v:FindFirstChild(targetBone)
            local h = v:FindFirstChild("Zombie") or v:FindFirstChildOfClass("Humanoid")
            if t and h and h.Health > 0 then
                local dist = (char.HumanoidRootPart.Position - t.Position).Magnitude
                if dist < globalRange then
                    local screenPos, onScreen = camera:WorldToViewportPoint(t.Position)
                    if onScreen then
                        local score = (Vector2.new(screenPos.X, screenPos.Y) - center).Magnitude
                        if score < fovRadius and score < minScore then
                            minScore, closest, targetHum = score, t, h
                        end
                    end
                end
            end
        end
    end

    if closest then
        if _G.AimbotEnabled then
            camera.CFrame = camera.CFrame:Lerp(CFrame.new(camera.CFrame.Position, closest.Position), smoothing)
        end
        if _G.SilentAimEnabled and gun and cd <= 0 then
            replicatedStorage.Library.RemotesManager.PrimaryFire:FireServer("#1", gun, {
                ["ShotPoint"] = char.HumanoidRootPart.Position, 
                ["Direction"] = (closest.Position - char.HumanoidRootPart.Position).Unit, 
                ["AmmoData"] = {["MaxAmmo"] = 0, ["Ammo"] = 0}, 
                ["TracerColor"] = Color3.new(0.6, 0.4, 1), -- Amethyst Tracer
                ["ShotId"] = math.random(1, 999), 
                ["HitInfoList"] = {{["Part"] = closest, ["Position"] = closest.Position, ["Normal"] = Vector3.new(0,1,0)}},
                ["ShotOrigin"] = gun.Handle.BulletOrigin, 
                ["Victims"] = {{["Humanoid"] = targetHum, ["Object"] = closest}},
                ["TargetPoints"] = {closest.Position}
            })
            cd = FIRE_RATE
        end
    end
end)

Rayfield:Notify({
   Title = "V12.7 Amethyst Ready",
   Content = "All systems operational.",
   Duration = 4,
})
