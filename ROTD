local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
   Name = "ULTIMATE V12.7: MASTER EDITION",
   LoadingTitle = "V12.6 Reborn",
   LoadingSubtitle = "by Gemini AI Partner",
   ConfigurationSaving = {
      Enabled = true,
      FolderName = "V12_Master_Configs",
      FileName = "MainScript"
   },
   KeySystem = false -- Set to true if you want a key system
})

-- [[ SHARED CONFIG ]]
_G.SilentAimEnabled = false
_G.AimbotEnabled = false
_G.AutoBuyAmmo = false
local wallCheckEnabled = false
local targetBone = "Head"
local weapon = "ak47"
local smoothing = 0.5
local globalRange = 600
local fovRadius = 150
local FIRE_RATE = 0.1
local cd = 0

-- [[ TABS ]]
local MainTab = Window:CreateTab("Combat", 4483362458) -- Sword Icon
local UtilityTab = Window:CreateTab("Utility", 4483345998) -- Gear Icon

-- [[ COMBAT SECTION ]]
MainTab:CreateSection("Main Cheats")

MainTab:CreateToggle({
   Name = "Silent Aim",
   CurrentValue = false,
   Callback = function(Value) _G.SilentAimEnabled = Value end,
})

MainTab:CreateToggle({
   Name = "Aimbot (Camera Lock)",
   CurrentValue = false,
   Callback = function(Value) _G.AimbotEnabled = Value end,
})

MainTab:CreateSlider({
   Name = "Aimbot Smoothing",
   Range = {1, 10},
   Increment = 1,
   Suffix = "Smoothness",
   CurrentValue = 5,
   Callback = function(Value) smoothing = Value / 10 end,
})

MainTab:CreateSection("Targeting Settings")

MainTab:CreateDropdown({
   Name = "Target Bone",
   Options = {"Head", "HumanoidRootPart"},
   CurrentOption = {"Head"},
   MultipleOptions = false,
   Callback = function(Option) targetBone = Option[1] end,
})

MainTab:CreateSlider({
   Name = "Field of View (FOV)",
   Range = {30, 800},
   Increment = 10,
   Suffix = "Radius",
   CurrentValue = 150,
   Callback = function(Value) fovRadius = Value end,
})

-- [[ UTILITY SECTION ]]
UtilityTab:CreateSection("Automation")

UtilityTab:CreateToggle({
   Name = "Auto Buy Ammo",
   CurrentValue = false,
   Callback = function(Value) _G.AutoBuyAmmo = Value end,
})

UtilityTab:CreateInput({
   Name = "Equipped Weapon Name",
   PlaceholderText = "e.g. ak47",
   RemoveTextAfterFocusLost = false,
   Callback = function(Text) weapon = Text end,
})

-- [[ ENGINE LOOP (Same reliable logic as V12.5) ]]
local player = game.Players.LocalPlayer
local camera = workspace.CurrentCamera
local replicatedStorage = game:GetService("ReplicatedStorage")

game:GetService("RunService").RenderStepped:Connect(function(delta)
    if not (_G.SilentAimEnabled or _G.AimbotEnabled) then return end
    cd = math.max(0, cd - delta)
    local char = player.Character
    local gun = char and char:FindFirstChild(weapon)
    if not char or not char:FindFirstChild("HumanoidRootPart") then return end
    
    local center = Vector2.new(camera.ViewportSize.X / 2, camera.ViewportSize.Y / 2)
    local closest, minScore, targetHum = nil, math.huge, nil
    local entities = workspace:FindFirstChild("Entity")
    
    if entities then
        for _, v in pairs(entities:GetChildren()) do
            local t = v:FindFirstChild(targetBone)
            local h = v:FindFirstChild("Zombie") or v:FindFirstChildOfClass("Humanoid")
            if t and h and h.Health > 0 then
                local dist = (char.HumanoidRootPart.Position - t.Position).Magnitude
                if dist < globalRange then
                    local screenPos, onScreen = camera:WorldToViewportPoint(t.Position)
                    if onScreen then
                        local score = (Vector2.new(screenPos.X, screenPos.Y) - center).Magnitude
                        if score < fovRadius and score < minScore then
                            minScore, closest, targetHum = score, t, h
                        end
                    end
                end
            end
        end
    end

    if closest then
        if _G.AimbotEnabled then
            camera.CFrame = camera.CFrame:Lerp(CFrame.new(camera.CFrame.Position, closest.Position), smoothing)
        end
        if _G.SilentAimEnabled and gun and cd <= 0 then
            replicatedStorage.Library.RemotesManager.PrimaryFire:FireServer("#1", gun, {
                ["ShotPoint"] = char.HumanoidRootPart.Position, 
                ["Direction"] = (closest.Position - char.HumanoidRootPart.Position).Unit, 
                ["AmmoData"] = {["MaxAmmo"] = 0, ["Ammo"] = 0}, 
                ["TracerColor"] = Color3.new(1, 1, 1), 
                ["ShotId"] = math.random(1, 999), 
                ["HitInfoList"] = {{["Part"] = closest, ["Position"] = closest.Position, ["Normal"] = Vector3.new(0,1,0)}},
                ["ShotOrigin"] = gun.Handle.BulletOrigin, 
                ["Victims"] = {{["Humanoid"] = targetHum, ["Object"] = closest}},
                ["TargetPoints"] = {closest.Position}
            })
            cd = FIRE_RATE
        end
    end
end)

Rayfield:Notify({
   Title = "V12.7 Loaded",
   Content = "Rayfield UI Initialized Successfully",
   Duration = 5,
   Image = 4483345998,
})
