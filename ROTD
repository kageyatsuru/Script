local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
   Name = "ULTIMATE V12.7",
   LoadingTitle = "Ex3cuting...",
   LoadingSubtitle = "Made By Ori",
   Theme = "Amethyst",
   ConfigurationSaving = { Enabled = true, FolderName = "V12_Configs", FileName = "CombatMaster" }
})

-- [[ SHARED CONFIG ]]
local replicatedStorage = game:GetService("ReplicatedStorage")
_G.SilentAimEnabled = false
_G.AimbotEnabled = false
_G.AutoReload = false
_G.ShowFOV = false

local weapon = "ak47"
local globalFOV = 150
local globalDist = 600
local smoothing = 0.5
local FIRE_RATE = 0.1
local cd = 0
local lastBuy = 0

-- [[ AMMO IDs ]]
local ammoIDs = {
    ["p250"] = "#1", ["tec-9"] = "#976", ["XM1014"] = "#9", ["MP5"] = "#40", 
    ["Sawed-off"] = "#70", ["MP7"] = "#147", ["AK-47"] = "#322", ["M4A4"] = "#193", 
    ["Flamethrower"] = "#939", ["AWP"] = "#367", ["Minigun"] = "#416", 
    ["Tactical Bow"] = "#797", ["Dual P250"] = "#886"
}

-- [[ WEAPON COLLECTION ]]
local weapons = {}
local prefabs = replicatedStorage:FindFirstChild("Prefabs")
if prefabs and prefabs.Items then
    for _, v in pairs(prefabs.Items:GetChildren()) do
        if v:FindFirstChild("Barral") or v:FindFirstChild("Barrel") then
            table.insert(weapons, v.Name)
        end
    end
end
table.sort(weapons)

-- [[ TABS ]]
local CombatTab = Window:CreateTab("Combat", 4483362458)
local QOLTab = Window:CreateTab("QOL", 4483345998)
local VisualsTab = Window:CreateTab("Visuals", 4483345998)

-- [[ REDESIGNED COMBAT TAB ]]

-- 1. SILENT AIM SECTION
CombatTab:CreateSection("— Silent Aim —")
CombatTab:CreateToggle({
   Name = "Enable Silent Aim",
   CurrentValue = false,
   Callback = function(v) _G.SilentAimEnabled = v end,
})

-- Weaponry moved directly under Silent Aim toggle
CombatTab:CreateDropdown({
   Name = "Select Weapon",
   Options = weapons,
   CurrentOption = {weapons[1] or "ak47"},
   MultipleOptions = false,
   Callback = function(Option) weapon = Option[1] end,
})

-- 2. AIMBOT SECTION
CombatTab:CreateSection("— Aimbot —")
CombatTab:CreateToggle({
   Name = "Enable Aimbot",
   CurrentValue = false,
   Callback = function(v) _G.AimbotEnabled = v end,
})
CombatTab:CreateSlider({
   Name = "Aimbot Smoothness",
   Range = {1, 10},
   Increment = 1,
   CurrentValue = 5,
   Callback = function(v) smoothing = v / 10 end,
})

-- 3. RANGE & DISTANCE SECTION (FOR BOTH)
CombatTab:CreateSection("— Range & FOV (Global) —")
CombatTab:CreateSlider({
   Name = "FOV Radius",
   Range = {10, 800},
   Increment = 10,
   CurrentValue = 150,
   Callback = function(v) globalFOV = v end,
})

CombatTab:CreateSlider({
   Name = "Max Distance",
   Range = {50, 2000},
   Increment = 50,
   CurrentValue = 600,
   Callback = function(v) globalDist = v end,
})

-- [[ QOL & VISUALS ]]
QOLTab:CreateSection("Automation")
QOLTab:CreateToggle({Name = "Auto-Buy Ammo", CurrentValue = false, Callback = function(v) _G.AutoReload = v end})
local BuyStatus = QOLTab:CreateLabel("Status: Idle")

VisualsTab:CreateToggle({Name = "Show FOV Circle", CurrentValue = false, Callback = function(v) _G.ShowFOV = v end})

-- [[ ENGINE LOOP ]]
local player = game.Players.LocalPlayer
local camera = workspace.CurrentCamera
local FovCircle = Drawing.new("Circle") -- Single Circle for both
FovCircle.Color, FovCircle.Thickness = Color3.fromRGB(150, 100, 255), 1

game:GetService("RunService").RenderStepped:Connect(function(delta)
    local center = Vector2.new(camera.ViewportSize.X / 2, camera.ViewportSize.Y / 2)
    FovCircle.Visible = _G.ShowFOV; FovCircle.Radius = globalFOV; FovCircle.Position = center

    local char = player.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then return end
    
    -- Auto-Buy Loop
    if _G.AutoReload and tick() - lastBuy > 3 then
        lastBuy = tick(); task.spawn(function()
            for name, id in pairs(ammoIDs) do
                if not _G.AutoReload then break end
                BuyStatus:Set("Buying: " .. name)
                pcall(function() replicatedStorage.Library.RemotesManager.ShopService:InvokeServer("buyammo", { StoreObj = workspace.Interactables.Shop_Sundays }, id) end)
                task.wait(0.1)
            end
            BuyStatus:Set("Status: Waiting...")
        end)
    end

    cd = math.max(0, cd - delta)
    local gun = char:FindFirstChild(weapon)
    local entities = workspace:FindFirstChild("Entity")
    if not entities then return end

    local target, minScore = nil, math.huge
    for _, v in pairs(entities:GetChildren()) do
        local t = v:FindFirstChild("Head") or v:FindFirstChild("HumanoidRootPart")
        local h = v:FindFirstChildOfClass("Humanoid") or v:FindFirstChild("Zombie")
        if t and h and h.Health > 0 then
            local dist = (char.HumanoidRootPart.Position - t.Position).Magnitude
            local screenPos, onScreen = camera:WorldToViewportPoint(t.Position)
            local mouseDist = (Vector2.new(screenPos.X, screenPos.Y) - center).Magnitude

            if onScreen and dist < globalDist and mouseDist < globalFOV then
                if mouseDist < minScore then minScore, target = mouseDist, t end
            end
        end
    end

    if target then
        -- Aimbot Execution
        if _G.AimbotEnabled then
            camera.CFrame = camera.CFrame:Lerp(CFrame.new(camera.CFrame.Position, target.Position), smoothing)
        end
        -- Silent Aim Execution
        if _G.SilentAimEnabled and gun and cd <= 0 then
            replicatedStorage.Library.RemotesManager.PrimaryFire:FireServer("#1", gun, {
                ["ShotPoint"] = char.HumanoidRootPart.Position, ["Direction"] = (target.Position - char.HumanoidRootPart.Position).Unit, 
                ["AmmoData"] = {["MaxAmmo"] = 0, ["Ammo"] = 0}, ["TracerColor"] = Color3.new(0.6, 0.4, 1),
                ["ShotId"] = math.random(1, 9999), ["HitInfoList"] = {{["Part"] = target, ["Position"] = target.Position, ["Normal"] = Vector3.new(0,1,0)}},
                ["ShotOrigin"] = gun.Handle.BulletOrigin, ["Victims"] = {{["Humanoid"] = target.Parent:FindFirstChildOfClass("Humanoid"), ["Object"] = target}},
                ["TargetPoints"] = {target.Position}
            })
            cd = FIRE_RATE
        end
    end
end)
