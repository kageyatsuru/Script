local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
   Name = "Ori's Forge Ex3",
   Icon = 0, 
   LoadingTitle = "3xe",
   LoadingSubtitle = "By Ori",
   ShowText = ":3",  
   Theme = "Amethyst", 
   ToggleUIKeybind = "X", 

   DisableRayfieldPrompts = false,
   DisableBuildWarnings = false, 

   ConfigurationSaving = {
      Enabled = true,
      FolderName = "Forge Ex3", 
      FileName = "Ex3"
   },

   Discord = {
      Enabled = false, 
      Invite = "noinvitelink", 
      RememberJoins = true 
   },

   KeySystem = false, 
   KeySettings = {
      Title = "Untitled",
      Subtitle = "Key System",
      Note = "No method of obtaining the key is provided", 
      FileName = "Key", 
      SaveKey = true, 
      GrabKeyFromSite = false,
      Key = {"Hello"} 
   }
})


local Tab = Window:CreateTab("Forge 3xe", 4483362458) -- Title, Image

local Section = Tab:CreateSection("Main")













local ACTIVATION_RATE = 0.1
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local ToolActivatedRF = ReplicatedStorage:WaitForChild("Shared"):WaitForChild("Packages"):WaitForChild("Knit"):WaitForChild("Services"):WaitForChild("ToolService"):WaitForChild("RF"):WaitForChild("ToolActivated")

local isMineToggled = false
local mineArgs = { "Pickaxe" }

local function startAutoMineLoop()
    spawn(function()
        while isMineToggled do
            local success, result = pcall(ToolActivatedRF.InvokeServer, ToolActivatedRF, unpack(mineArgs))
            if not success then
                warn("AutoMine InvokeServer failed:", result)
            end
            wait(ACTIVATION_RATE)
        end
    end)
end


local function toggleAutoMine(newValue)
    isMineToggled = newValue
    if isMineToggled then
        startAutoMineLoop()
    end
end


local ToggleMine = Tab:CreateToggle({
    Name = "Auto Mine (Pickaxe)",
    CurrentValue = false,
    Flag = "Toggle2", 
    Callback = function(Value)
        toggleAutoMine(Value) 
    end,
})

local KeybindMine = Tab:CreateKeybind({
    Name = "Auto Mine Keybind",
    CurrentKeybind = "C",
    HoldToInteract = false,
    Flag = "Toggle2", 
    Callback = function(KeybindHeld)
        local newValue = not isMineToggled 
        toggleAutoMine(newValue)
    end,
})


local isSwingToggled = false
local swingArgs = { "Weapon" } 

local function startAutoSwingLoop()
    spawn(function()
        while isSwingToggled do
            local success, result = pcall(ToolActivatedRF.InvokeServer, ToolActivatedRF, unpack(swingArgs))
            if not success then
                warn("AutoSwing InvokeServer failed:", result)
            end
            wait(ACTIVATION_RATE)
        end
    end)
end


local function toggleAutoSwing(newValue)
    isSwingToggled = newValue
    if isSwingToggled then
        startAutoSwingLoop()
    end
end


local ToggleSwing = Tab:CreateToggle({
    Name = "Auto Swing (Weapon)",
    CurrentValue = false,
    Flag = "Toggle3",
    Callback = function(Value)
        toggleAutoSwing(Value) 
    end,
})

local KeybindSwing = Tab:CreateKeybind({
    Name = "Auto Swing Keybind",
    CurrentKeybind = "V",
    HoldToInteract = false,
    Flag = "Toggle3", 
    Callback = function(KeybindHeld)
        local newValue = not isSwingToggled 
        toggleAutoSwing(newValue)
    end,
})





































































-- ==========================================================
-- 1. SETUP: REMOTE FUNCTIONS, CONTROL VARIABLES, AND ITEM LIST
-- (Keep this section at the very top)
-- ==========================================================

local RunCommandRF = game:GetService("ReplicatedStorage"):WaitForChild("Shared")
    :WaitForChild("Packages"):WaitForChild("Knit"):WaitForChild("Services")
    :WaitForChild("DialogueService"):WaitForChild("RF"):WaitForChild("RunCommand")

local isSellToggled = false
local sellThread = nil
local SELL_RATE = 5 

local ALL_SELLABLE_ITEMS = { 
    -- ... your full list of items here ... 
    "Stone", "Copper", "Iron", "Cardboardite", "Sand Stone",
    "Tin", "Silver", "Bananite", "Gold", "Mushroomite", "Platinum",
    "Aite", "Poopite", "Boneite", "Dark Boneite", "Slimite", 
    "Cobalt", "Titanium", "Lapis Lazuli", "Quartz", "Amethyst", "Topaz", 
    "Diamond", "Sapphire", "Volcanic Rock", "Cuprite", "Obsidian", 
    "Emerald", "Ruby", "Rivalite",
}

-- CORRECTED LOCATION: MUST be defined here
local selectedItemsToSell = ALL_SELLABLE_ITEMS -- Start with all selected


-- ==========================================================
-- 2. HANDLER FUNCTIONS (MUST BE DEFINED BEFORE UI USES THEM)
-- ==========================================================

-- LOGIC: AUTO-SELL LOOP 
local function startAutoSellLoop()
    if sellThread then task.cancel(sellThread) end
    
    sellThread = task.spawn(function()
        while isSellToggled do
            if #selectedItemsToSell > 0 then
                local basket = {}
                for _, itemName in ipairs(selectedItemsToSell) do
                    basket[itemName] = 1 
                end
                
                local filteredPayload = { "SellConfirm", { Basket = basket } }
                
                local success, result = pcall(RunCommandRF.InvokeServer, RunCommandRF, unpack(filteredPayload))
                
                if not success then
                    warn("AutoSell InvokeServer failed:", result)
                end
            end
            
            task.wait(SELL_RATE)
        end
        sellThread = nil
    end)
end

-- Function to handle turning the feature on/off
local function toggleAutoSell(newValue)
    isSellToggled = newValue
    
    if isSellToggled then
        startAutoSellLoop()
    else
        if sellThread then
            task.cancel(sellThread)
            sellThread = nil
        end
    end
end

-- Assuming these lines successfully create your UI objects
local Tab = Window:CreateTab("Auto Sell", 4483362458)
local Section = Tab:CreateSection("Sell")

-- ==========================================================
-- 3. UI DEFINITIONS (ORDER MATTERS FOR UI DEPENDENCIES)
-- ==========================================================

local Dropdown = Tab:CreateDropdown({
    Name = "Select Items to Auto-Sell",
    Options = ALL_SELLABLE_ITEMS, 
    CurrentOption = selectedItemsToSell, 
    MultipleOptions = true, 
    Flag = "AutoSellItems", 
    Callback = function(Options)
        selectedItemsToSell = Options 
        print("Selected items updated. Total selected:", #selectedItemsToSell)
    end,
})

-- Define ToggleSell BEFORE KeybindSell uses it
local ToggleSell = Tab:CreateToggle({
    Name = "Auto Sell (Filterable)",
    CurrentValue = false,
    Flag = "ToggleAutoSell",
    Callback = toggleAutoSell,
})

local KeybindSell = Tab:CreateKeybind({
    Name = "Auto Sell Keybind",
    CurrentKeybind = "B", 
    HoldToInteract = false,
    Flag = "KeybindAutoSell", 
    Callback = function(KeybindHeld)
        if not KeybindHeld then return end
        local newValue = not isSellToggled 
        toggleAutoSell(newValue)
        
        -- This line relies on ToggleSell being defined immediately above
        ToggleSell:SetValue(newValue) 
    end,
})



































































local Tab = Window:CreateTab("Shop", 4483362458) -- Title, Image

local Section = Tab:CreateSection("Potion Only Works When near The Shop")





local Button = Tab:CreateButton({
   Name = "Buy Health Potion 2 (1)",
   Callback = function()
    local args = {
	"HealthPotion2",
	1
}
game:GetService("ReplicatedStorage"):WaitForChild("Shared"):WaitForChild("Packages"):WaitForChild("Knit"):WaitForChild("Services"):WaitForChild("ProximityService"):WaitForChild("RF"):WaitForChild("Purchase"):InvokeServer(unpack(args))
end, }
)



local Button = Tab:CreateButton({
   Name = "Buy Damage Potion (1)",
   Callback = function()
local args = {
	"AttackDamagePotion1",
	1
}
game:GetService("ReplicatedStorage"):WaitForChild("Shared"):WaitForChild("Packages"):WaitForChild("Knit"):WaitForChild("Services"):WaitForChild("ProximityService"):WaitForChild("RF"):WaitForChild("Purchase"):InvokeServer(unpack(args))

end, }
)



local Button = Tab:CreateButton({
   Name = "Buy Miner Potion (1)",
   Callback = function()

local args = {
	"MinerPotion1",
	1
}
game:GetService("ReplicatedStorage"):WaitForChild("Shared"):WaitForChild("Packages"):WaitForChild("Knit"):WaitForChild("Services"):WaitForChild("ProximityService"):WaitForChild("RF"):WaitForChild("Purchase"):InvokeServer(unpack(args))

    
end, }
)




local Button = Tab:CreateButton({
   Name = "Buy Speed Potion (1)",
   Callback = function()

local args = {
	"MovementSpeedPotion1",
	1
}
game:GetService("ReplicatedStorage"):WaitForChild("Shared"):WaitForChild("Packages"):WaitForChild("Knit"):WaitForChild("Services"):WaitForChild("ProximityService"):WaitForChild("RF"):WaitForChild("Purchase"):InvokeServer(unpack(args))

    
end, }
)




local Button = Tab:CreateButton({
   Name = "Buy Luck Potion (1)",
   Callback = function()

local args = {
	"LuckPotion1",
	1
}
game:GetService("ReplicatedStorage"):WaitForChild("Shared"):WaitForChild("Packages"):WaitForChild("Knit"):WaitForChild("Services"):WaitForChild("ProximityService"):WaitForChild("RF"):WaitForChild("Purchase"):InvokeServer(unpack(args))

    
end, }
)
























































local Tab = Window:CreateTab("Uis", 4483362458) -- Title, Image

local Section = Tab:CreateSection("Guis")





local Button = Tab:CreateButton({
   Name = "Open Forge",
   Callback = function()
local args = {
	workspace:WaitForChild("Proximity"):WaitForChild("Forge")
}
game:GetService("ReplicatedStorage"):WaitForChild("Shared"):WaitForChild("Packages"):WaitForChild("Knit"):WaitForChild("Services"):WaitForChild("ProximityService"):WaitForChild("RF"):WaitForChild("Forge"):InvokeServer(unpack(args))
end,}
)























































local Tab = Window:CreateTab("Misc", 4483362458) -- Title, Image

local Section = Tab:CreateSection("QoL")






-- ==========================================================
-- 1. Setup: Remote Functions & Control Variables
-- ==========================================================

-- Remote Function Definitions (Keep these the same)
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local CharacterServiceRF = ReplicatedStorage:WaitForChild("Shared")
    :WaitForChild("Packages"):WaitForChild("Knit"):WaitForChild("Services")
    :WaitForChild("CharacterService"):WaitForChild("RF")

local RunRF = CharacterServiceRF:WaitForChild("Run")
local StopRunRF = CharacterServiceRF:WaitForChild("StopRun")

-- Control Variables for the persistent loop
local autoRunThread = nil
local isAutoRunEnabled = false 

-- ==========================================================
-- 2. Persistent Auto-Run Loop Function
-- ==========================================================

local function startAutoRunLoop()
    if autoRunThread then
        task.cancel(autoRunThread)
    end

    autoRunThread = task.spawn(function()
        while isAutoRunEnabled do
            RunRF:InvokeServer() 
            task.wait(0.1) 
        end
        autoRunThread = nil
        -- IMPORTANT: The character will stop running here once the loop breaks, 
        -- but we also ensure a clean stop in the Callback below.
    end)
end

-- ==========================================================
-- 3. The Toggle UI Implementation
-- (Place this where you define your other toggles inside the Tab)
-- ==========================================================

local ToggleAutoRun = Tab:CreateToggle({
    Name = "Auto Run (Persistent)",
    CurrentValue = false, 
    Flag = "AutoRunFlag", 
    
    Callback = function(Value)
        isAutoRunEnabled = Value 
        
        if isAutoRunEnabled then
            -- Toggled ON: Start the persistent loop
            startAutoRunLoop()
            
        else
            -- Toggled OFF: Stop the loop & issue stop command
            if autoRunThread then
                task.cancel(autoRunThread)
                autoRunThread = nil 
            end
            StopRunRF:InvokeServer()
        end
    end,
})






























local Tab = Window:CreateTab("Scripts", 4483362458) -- Title, Image

local Section = Tab:CreateSection("Extras")



local Button = Tab:CreateButton({
   Name = "Ex3c Simca Hub",
   Callback = function()
    loadstring(game:HttpGet("https://api.luarmor.net/files/v3/loaders/38d7e491ea3a0f6085bebbb240f1d340.lua"))() 

   -- The function that takes place when the button is pressed
   end,
})

local Button = Tab:CreateButton({
   Name = "Ex3c IY",
   Callback = function()
    loadstring(game:HttpGet('https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source'))()

   -- The function that takes place when the button is pressed
   end,
})


local Button = Tab:CreateButton({
   Name = "Ex3c Translator",
   Callback = function()
    loadstring(game:HttpGet("https://raw.githubusercontent.com/ltseverydayyou/uuuuuuu/refs/heads/main/translatoooor")) ()


   -- The function that takes place when the button is pressed
   end,
})
