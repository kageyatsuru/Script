-- [[ PRECISION AIMBOT V11 - SILENT AIM & CAMERA COMBO ]]

-- 1. SILENT AIM HOOK (Fixes Hit-Registration)
local mt = getrawmetatable(game)
local oldIndex = mt.__index
setreadonly(mt, false)

mt.__index = newcclosure(function(self, index)
    -- Check if Aimbot is enabled and if the gun is asking where the mouse is
    if _G.isEnabled and (index == "Hit" or index == "Target") then
        local camera = workspace.CurrentCamera
        local entities = workspace:FindFirstChild("Entity")
        
        if entities then
            local closest = nil
            local minMouseDist = 200 -- Only "Silent Aim" if they are near the crosshair
            
            for _, v in pairs(entities:GetChildren()) do
                local head = v:FindFirstChild("Head")
                local hum = v:FindFirstChild("Zombie") or v:FindFirstChildOfClass("Humanoid")
                
                if head and hum and hum.Health > 0 then
                    local screenPos, onScreen = camera:WorldToViewportPoint(head.Position)
                    if onScreen then
                        local mouseDist = (Vector2.new(screenPos.X, screenPos.Y) - Vector2.new(camera.ViewportSize.X/2, camera.ViewportSize.Y/2)).Magnitude
                        if mouseDist < minMouseDist then
                            minMouseDist = mouseDist
                            closest = head
                        end
                    end
                end
            end
            
            if closest then
                if index == "Hit" then return closest.CFrame end
                if index == "Target" then return closest end
            end
        end
    end
    return oldIndex(self, index)
end)
setreadonly(mt, true)

-- 2. START OF YOUR ORIGINAL SCRIPT LOGIC
local replicatedStorage = game:GetService("ReplicatedStorage")
local player = game:GetService("Players").LocalPlayer
local runService = game:GetService("RunService")
local uis = game:GetService("UserInputService")
local camera = workspace.CurrentCamera

-- CONTROL VARIABLES
_G.isEnabled = false -- Using _G so the hook above can see this variable
local aimMode = "Crosshair" 
local targetBone = "Head" 
local smoothing = 0.5 
local wallCheckEnabled = true 
local dragging = false
local dragStart, startPos

-- [The rest of the UI and Aimbot code follows...]
-- (I've updated the toggleBtn below to use _G.isEnabled)

-- AIMBOT SETTINGS
local maxDistance = 600 
local fovRadius = 150 
local MIN_DIST, MAX_DIST = 50, 1000
local MIN_FOV, MAX_FOV = 50, 500
local STEP = 50 

-- FOV CIRCLE
local fovCircle = Drawing.new("Circle")
fovCircle.Thickness = 1.5
fovCircle.Color = Color3.fromRGB(50, 255, 150)
fovCircle.Visible = false

-- [[ UI SETUP ]]
local screenGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
screenGui.Name = "Precision_V11"
screenGui.ResetOnSpawn = false

local container = Instance.new("Frame", screenGui)
container.Size = UDim2.new(0, 150, 0, 50)
container.Position = UDim2.new(0.95, -150, 0.4, 0) 
container.BackgroundTransparency = 1

local toggleBtn = Instance.new("TextButton", container)
toggleBtn.Size = UDim2.new(0, 50, 0, 50)
toggleBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
toggleBtn.Text = "OFF"
toggleBtn.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", toggleBtn)

-- (Settings Menu, Sliders, and Bone Buttons remain exactly as before)
-- Note: I'm keeping this compact, but the logic remains V10.2 + Silent Aim.

local mainFrame = Instance.new("Frame", container)
mainFrame.Size = UDim2.new(0, 100, 0, 50)
mainFrame.Position = UDim2.new(0, 55, 0, 0)
mainFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
Instance.new("UICorner", mainFrame)

local expandButton = Instance.new("TextButton", mainFrame)
expandButton.Size = UDim2.new(1, 0, 1, 0)
expandButton.Text = "Settings"
expandButton.TextColor3 = Color3.new(1, 1, 1)
expandButton.BackgroundTransparency = 1

local extraMenu = Instance.new("Frame", mainFrame)
extraMenu.Size = UDim2.new(1, 0, 0, 190)
extraMenu.Position = UDim2.new(0, 0, 1, 5)
extraMenu.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
extraMenu.Visible = false
Instance.new("UICorner", extraMenu)

-- Bone Toggle Logic
local function getBestPart(entity)
    if targetBone == "Head" then
        return entity:FindFirstChild("Head") or entity:FindFirstChild("HumanoidRootPart")
    else
        return entity:FindFirstChild("HumanoidRootPart") or entity:FindFirstChild("UpperTorso")
    end
end

toggleBtn.MouseButton1Click:Connect(function()
    _G.isEnabled = not _G.isEnabled
    toggleBtn.Text = _G.isEnabled and "ON" or "OFF"
    toggleBtn.BackgroundColor3 = _G.isEnabled and Color3.fromRGB(50, 200, 50) or Color3.fromRGB(200, 50, 50)
    if aimMode == "Crosshair" then fovCircle.Visible = _G.isEnabled end
end)

expandButton.MouseButton1Click:Connect(function() extraMenu.Visible = not extraMenu.Visible end)

-- [[ AIMBOT CORE LOOP ]]
runService.RenderStepped:Connect(function()
    local screenCenter = Vector2.new(camera.ViewportSize.X / 2, camera.ViewportSize.Y / 2)
    fovCircle.Position = screenCenter
    fovCircle.Radius = fovRadius
    
    if not _G.isEnabled then 
        uis.MouseBehavior = Enum.MouseBehavior.Default
        return 
    end
    
    uis.MouseBehavior = Enum.MouseBehavior.LockCenter
    
    local char = player.Character
    local root = char and char:FindFirstChild("HumanoidRootPart")
    if not root then return end
    
    local closestTarget = nil
    local minScore = math.huge 

    local entities = workspace:FindFirstChild("Entity")
    if entities then
        for _, v in pairs(entities:GetChildren()) do
            local targetPart = getBestPart(v)
            local hum = v:FindFirstChild("Zombie") or v:FindFirstChildOfClass("Humanoid")
            
            if targetPart and hum and hum.Health > 0 then
                local worldDist = (root.Position - targetPart.Position).Magnitude
                if worldDist < maxDistance then
                    local screenPos, onScreen = camera:WorldToViewportPoint(targetPart.Position)
                    if onScreen then
                        local mouseDist = (Vector2.new(screenPos.X, screenPos.Y) - screenCenter).Magnitude
                        if mouseDist < fovRadius and mouseDist < minScore then
                            minScore = mouseDist
                            closestTarget = targetPart
                        end
                    end
                end
            end
        end
    end

    if closestTarget then
        local targetCFrame = CFrame.new(camera.CFrame.Position, closestTarget.Position)
        camera.CFrame = camera.CFrame:Lerp(targetCFrame, smoothing)
    end
end)
