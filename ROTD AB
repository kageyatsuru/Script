-- [[ PRECISION V13 - PURE SILENT AIM ]]

local player = game:GetService("Players").LocalPlayer
local camera = workspace.CurrentCamera
_G.isEnabled = false

-- 1. THE SILENT AIM HOOK (Zero Lag)
local mt = getrawmetatable(game)
local oldNamecall = mt.__namecall
setreadonly(mt, false)

mt.__namecall = newcclosure(function(self, ...)
    local method = getnamecallmethod()
    local args = {...}

    -- Listen for the gun sending damage/hit data to the server
    if _G.isEnabled and (method == "FireServer" or method == "InvokeServer") then
        local entities = workspace:FindFirstChild("Entity")
        if entities then
            local closest = nil
            local minMouseDist = 150 -- Target must be within this many pixels of your center
            
            for _, v in pairs(entities:GetChildren()) do
                local head = v:FindFirstChild("Head")
                local hum = v:FindFirstChild("Zombie") or v:FindFirstChildOfClass("Humanoid")
                
                if head and hum and hum.Health > 0 then
                    -- Check if they are on your screen
                    local pos, onScreen = camera:WorldToViewportPoint(head.Position)
                    if onScreen then
                        local mouseDist = (Vector2.new(pos.X, pos.Y) - Vector2.new(camera.ViewportSize.X/2, camera.ViewportSize.Y/2)).Magnitude
                        if mouseDist < minMouseDist then
                            minMouseDist = mouseDist
                            closest = head
                        end
                    end
                end
            end
            
            -- REDIRECT THE BULLET
            if closest then
                for i, arg in pairs(args) do
                    if typeof(arg) == "Vector3" then
                        args[i] = closest.Position
                    elseif typeof(arg) == "Instance" and arg:IsA("BasePart") then
                        args[i] = closest
                    end
                end
                return oldNamecall(self, unpack(args))
            end
        end
    end
    return oldNamecall(self, unpack(args))
end)
setreadonly(mt, true)

-- 2. SIMPLE TOGGLE UI
local screenGui = Instance.new("ScreenGui", player.PlayerGui)
screenGui.DisplayOrder = 999

local toggleBtn = Instance.new("TextButton", screenGui)
toggleBtn.Size = UDim2.new(0, 100, 0, 50)
toggleBtn.Position = UDim2.new(0.5, -50, 0.05, 0)
toggleBtn.Text = "SILENT: OFF"
toggleBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
toggleBtn.TextColor3 = Color3.new(1,1,1)
toggleBtn.Draggable = true -- Built-in Roblox dragging (Low lag)

toggleBtn.MouseButton1Click:Connect(function()
    _G.isEnabled = not _G.isEnabled
    toggleBtn.Text = _G.isEnabled and "SILENT: ON" or "SILENT: OFF"
    toggleBtn.BackgroundColor3 = _G.isEnabled and Color3.fromRGB(50, 200, 50) or Color3.fromRGB(200, 50, 50)
end)
